{{define "content"}}
<div class="space-y-6">
  <div>
    <h1 class="text-xl font-bold">æ¦‚è§ˆ</h1>
    <div class="text-sm opacity-70">é…ç½®ã€è§„åˆ™ã€ä»»åŠ¡å®æ—¶ç»Ÿè®¡</div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    <div class="card bg-base-100 border border-base-200 border-l-4 border-primary shadow-sm">
      <div class="card-body">
        <div class="card-title text-base flex justify-between">
          è¿è¡Œä¿¡æ¯
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-primary">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
          </svg>
        </div>
        <div class="text-sm"><span class="opacity-70">rclone é…ç½®ï¼š</span><b>{{.RcloneConfigPathDisplay}}</b></div>
        <div class="text-sm"><span class="opacity-70">æ—¥å¿—ç›®å½•ï¼š</span><b>{{.LogDir}}</b></div>
      </div>
    </div>
    <div class="card bg-base-100 border border-base-200 border-l-4 border-secondary shadow-sm">
      <div class="card-body">
        <div class="card-title text-base flex justify-between">
          å®æ—¶çŠ¶æ€
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-secondary">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
          </svg>
        </div>
        <div class="text-sm"><span class="opacity-70">å½“å‰æ€»é€Ÿåº¦ï¼š</span><b id="statSpeed" class="tabular-nums text-lg">{{humanSpeed .TotalSpeed}}</b></div>
        <div class="text-sm"><span class="opacity-70">è¿è¡Œä¸­ä»»åŠ¡ï¼š</span><b class="tabular-nums">{{.RunningJobs}}</b></div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="card bg-base-100 border border-base-200 shadow-sm">
      <div class="card-body flex flex-row items-center gap-4">
        <div class="p-3 bg-primary/10 rounded-full text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div>
          <div class="text-xs opacity-70 font-bold uppercase tracking-wide">ä»Šæ—¥ä¼ è¾“</div>
          <div class="text-2xl font-bold tabular-nums text-primary" id="statToday">{{humanBytes .BytesToday}}</div>
          <div class="text-xs opacity-50">è‡ªä»Šæ—¥ 00:00 èµ·</div>
        </div>
      </div>
    </div>
    <div class="card bg-base-100 border border-base-200 shadow-sm">
      <div class="card-body flex flex-row items-center gap-4">
        <div class="p-3 bg-secondary/10 rounded-full text-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3" />
          </svg>
        </div>
        <div>
          <div class="text-xs opacity-70 font-bold uppercase tracking-wide">è¿‡å» 24 å°æ—¶</div>
          <div class="text-2xl font-bold tabular-nums text-secondary" id="stat24h">{{humanBytes .Bytes24h}}</div>
          <div class="text-xs opacity-50">æ»šåŠ¨ç»Ÿè®¡</div>
        </div>
      </div>
    </div>
    <div class="card bg-base-100 border border-base-200 shadow-sm">
      <div class="card-body flex flex-row items-center gap-4">
        <div class="p-3 bg-neutral/10 rounded-full text-neutral">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
            <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
          </svg>
        </div>
        <div>
          <div class="text-xs opacity-70 font-bold uppercase tracking-wide">å†å²æ€»è®¡</div>
          <div class="text-2xl font-bold tabular-nums">{{humanBytes .TotalBytes}}</div>
          <div class="text-xs opacity-50">æ‰€æœ‰å·²å½’æ¡£ä»»åŠ¡</div>
        </div>
      </div>
    </div>
  </div>

  {{if .LimitGroups}}
  <div class="card bg-base-100 border border-base-200 shadow-sm">
    <div class="card-body">
      <div class="card-title text-base flex justify-between mb-2">
        é™æµåˆ†ç»„çŠ¶æ€ (24h)
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-accent">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m0-10.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.75c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.57-.598-3.75h-.152c-3.196 0-6.1-1.249-8.25-3.286zm0 13.036h.008v.008H12v-.008z" />
        </svg>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {{range .LimitGroups}}
          <div class="flex flex-col gap-1 p-3 rounded-lg border {{if ge .Usage .Limit}}border-error bg-error/5{{else}}border-base-200 bg-base-200/30{{end}}">
            <div class="flex justify-between items-center">
              <span class="font-bold text-sm truncate">{{.Name}}</span>
              <span class="text-xs opacity-60">{{if gt .Limit 0}}{{humanBytes .Usage}} / {{humanBytes .Limit}}{{else}}{{humanBytes .Usage}} / ä¸é™{{end}}</span>
            </div>
            <progress class="progress w-full {{if ge .Usage .Limit}}progress-error{{else}}progress-primary{{end}}" value="{{.Usage}}" max="{{if gt .Limit 0}}{{.Limit}}{{else}}{{.Usage}}{{end}}"></progress>
            {{if ge .Usage .Limit}}
              <div class="text-[10px] text-error font-bold text-right uppercase">å·²è¶…é™</div>
            {{end}}
          </div>
        {{end}}
      </div>
    </div>
  </div>
  {{end}}

  <div class="card bg-base-100 border border-base-200">
    <div class="card-body">
      <div class="card-title text-base">å®æ—¶æ›²çº¿</div>
      <div class="flex flex-wrap gap-2 items-center">
        <select id="rtRule" class="select select-bordered select-sm w-full sm:w-56">
          <option value="">å…¨å±€</option>
          {{range .Rules}}<option value="{{.Rule.ID}}">{{.Rule.ID}}</option>{{end}}
        </select>
        <select id="rtWindow" class="select select-bordered select-sm w-full sm:w-44">
          <option value="900">æœ€è¿‘ 15 åˆ†é’Ÿ</option>
          <option value="3600" selected>æœ€è¿‘ 1 å°æ—¶</option>
          <option value="21600">æœ€è¿‘ 6 å°æ—¶</option>
          <option value="86400">æœ€è¿‘ 24 å°æ—¶</option>
        </select>
        <div class="text-sm opacity-70">æ›²çº¿ä¸è½åº“ï¼Œä»…åœ¨æœ¬é¡µé¢æ‰“å¼€åå¼€å§‹é‡‡æ ·ã€‚</div>
      </div>

      <div id="rtEmpty" class="alert alert-info mt-3" style="display:none">
        <span>å½“å‰æ²¡æœ‰è¿è¡Œä¸­çš„ä»»åŠ¡ï¼Œå®æ—¶æ›²çº¿å°†ä¿æŒç©ºé—²çŠ¶æ€ï¼ˆå½“æœ‰ä»»åŠ¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨å¼€å§‹ç»˜åˆ¶ï¼‰ã€‚</span>
      </div>

      <div class="mt-4">
        <div>
          <div class="text-sm opacity-70 mb-2">æ€»é€Ÿåº¦</div>
          <canvas id="rtSpeed" style="width:100%; height:260px; border:1px solid hsl(var(--b2)); border-radius:12px;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="card bg-base-100 border border-base-200 shadow-sm">
    <div class="card-body p-0">
      <div class="px-6 py-4 flex justify-between items-center border-b border-base-200">
        <h2 class="card-title text-base">åŒæ­¥è§„åˆ™çŠ¶æ€</h2>
        <a class="btn btn-ghost btn-xs" href="/rules">æŸ¥çœ‹å…¨éƒ¨</a>
      </div>
      <div class="overflow-x-auto">
        <table class="table table-sm w-full border-separate border-spacing-0">
          <thead>
            <tr>
              <th class="bg-base-100 border-b border-base-200 w-16">ID</th>
              <th class="bg-base-100 border-b border-base-200 w-12 text-center">çŠ¶æ€</th>
              <th class="bg-base-100 border-b border-base-200">æ˜ å°„è·¯å¾„</th>
              <th class="bg-base-100 border-b border-base-200">å®æ—¶ç»Ÿè®¡</th>
            </tr>
          </thead>
          <tbody>
            {{range .Rules}}
            <tr class="hover:bg-base-200/40 group">
              <td class="align-top font-mono text-xs pt-3"><a class="link" href="/rules/edit?id={{.Rule.ID}}">{{.Rule.ID}}</a></td>
              <td class="align-top pt-3 text-center">
                <div class="w-2 h-2 rounded-full mx-auto {{if .Rule.Enabled}}bg-success shadow-[0_0_8px_rgba(34,197,94,0.6)]{{else}}bg-base-300{{end}}" title="{{if .Rule.Enabled}}å·²å¯ç”¨{{else}}å·²åœæ­¢{{end}}"></div>
              </td>
              <td class="align-top pt-3">
                <div class="flex flex-col gap-0.5 text-xs">
                  <div class="truncate opacity-80" title="{{if eq .Rule.SrcKind "local"}}{{.Rule.SrcLocalRoot}}{{else}}{{.Rule.SrcRemote}}:{{.Rule.SrcPath}}{{end}}">
                    {{if eq .Rule.SrcKind "local"}}ğŸ“‚{{else}}â˜ï¸{{end}} {{if eq .Rule.SrcKind "local"}}{{.Rule.SrcLocalRoot}}{{else}}{{.Rule.SrcRemote}}:{{.Rule.SrcPath}}{{end}}
                  </div>
                  <div class="truncate opacity-80" title="{{.Rule.DstRemote}}:{{.Rule.DstPath}}">
                    â˜ï¸ {{.Rule.DstRemote}}:{{.Rule.DstPath}}
                  </div>
                </div>
              </td>
              <td class="align-top pt-2">
                <div class="flex flex-col gap-1.5">
                  <div class="flex flex-wrap gap-x-3 gap-y-1 text-[10px] opacity-80">
                    <span class="{{if gt .Counts.Transferring 0}}text-primary font-bold{{end}}">â–¶ï¸ {{.Counts.Transferring}}</span>
                    <span>â³ {{.Counts.Queued}}</span>
                    <span>âœ… {{.Counts.Done}}</span>
                    {{if gt .Counts.Failed 0}}<span class="text-error font-bold">âŒ {{.Counts.Failed}}</span>{{end}}
                  </div>
                  {{if .Rule.LimitGroup}}
                    <div class="flex items-center gap-2 text-[9px] opacity-60">
                      <span class="badge badge-xs badge-ghost scale-90 origin-left">ç»„: {{.Rule.LimitGroup}}</span>
                      <span class="{{if ge .Usage24h .GroupLimit}}text-error font-bold{{end}}">{{humanBytes .Usage24h}}{{if gt .GroupLimit 0}}/{{humanBytes .GroupLimit}}{{end}}</span>
                    </div>
                  {{else if gt .Usage24h 0}}
                    <div class="text-[9px] opacity-50">24h: {{humanBytes .Usage24h}}</div>
                  {{end}}
                </div>
              </td>
            </tr>
            {{end}}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card bg-base-100 border border-base-200">
    <div class="card-body">
      <div class="card-title text-base">æœ€è¿‘ä»»åŠ¡</div>
      <div class="overflow-x-auto">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>ä»»åŠ¡ ID</th>
              <th>è§„åˆ™</th>
              <th>æ¨¡å¼</th>
              <th>çŠ¶æ€</th>
              <th>å¼€å§‹æ—¶é—´</th>
              <th>å·²ä¼ è¾“</th>
              <th>é€Ÿåº¦</th>
            </tr>
          </thead>
          <tbody>
            {{range .Jobs}}
            <tr class="hover:bg-base-200/40">
              <td><a class="link" href="/jobs/view?id={{.Job.JobID}}">{{.Job.JobID}}</a></td>
              <td>{{if hasPrefix .Job.RuleID "manual_"}}æ‰‹åŠ¨è¿è¡Œ{{else}}{{.Job.RuleID}}{{end}}</td>
              <td>{{.Job.TransferMode}}</td>
              <td>
                <span class="badge {{if eq .Job.Status "running"}}badge-success{{else if eq .Job.Status "failed"}}badge-error{{else if eq .Job.Status "terminated"}}badge-warning{{else}}badge-info{{end}}">{{.Job.Status}}</span>
              </td>
              <td class="opacity-70">{{ts .Job.StartedAt}}</td>
              <td class="opacity-70">{{if .HasM}}{{humanBytes .Metric.Bytes}}{{else}}{{humanBytes .Job.BytesDone}}{{end}}</td>
              <td class="opacity-70">{{if .HasM}}{{humanSpeed .Metric.Speed}}{{else}}{{humanSpeed .Job.AvgSpeed}}{{end}}</td>
            </tr>
            {{end}}
          </tbody>
        </table>
      </div>

      <div class="mt-3 flex flex-wrap gap-2 items-center justify-between">
        <div class="text-sm opacity-70">å…± {{.JobsTotal}} æ¡ï¼Œé¡µå¤§å° {{.JobsPageSize}}ï¼Œç¬¬ {{.JobsPage}} / {{.JobsTotalPages}} é¡µ</div>
        <div class="flex flex-wrap gap-2 items-center">
          <form method="get" action="/" class="flex flex-wrap gap-2 items-center">
            <select name="jobs_page_size" class="select select-bordered select-sm" onchange="this.form.jobs_page.value='1'; this.form.submit();">
              <option value="10" {{if eq .JobsPageSize 10}}selected{{end}}>10 / é¡µ</option>
              <option value="20" {{if eq .JobsPageSize 20}}selected{{end}}>20 / é¡µ</option>
              <option value="50" {{if eq .JobsPageSize 50}}selected{{end}}>50 / é¡µ</option>
              <option value="100" {{if eq .JobsPageSize 100}}selected{{end}}>100 / é¡µ</option>
            </select>
            <input type="number" min="1" max="{{.JobsTotalPages}}" name="jobs_page" value="{{.JobsPage}}" class="input input-bordered input-sm w-28" placeholder="è·³è½¬é¡µç ">
            <button class="btn btn-sm" type="submit">è·³è½¬</button>
          </form>
          {{if .JobsHasPrev}}
            <a class="btn btn-ghost btn-sm" href="{{.JobsPrevURL}}">ä¸Šä¸€é¡µ</a>
          {{else}}
            <button class="btn btn-ghost btn-sm" disabled>ä¸Šä¸€é¡µ</button>
          {{end}}
          {{if .JobsHasNext}}
            <a class="btn btn-ghost btn-sm" href="{{.JobsNextURL}}">ä¸‹ä¸€é¡µ</a>
          {{else}}
            <button class="btn btn-ghost btn-sm" disabled>ä¸‹ä¸€é¡µ</button>
          {{end}}
          <a class="btn btn-sm btn-info text-info-content" href="/jobs">æ‰“å¼€ä»»åŠ¡åˆ—è¡¨</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/static/realtime_chart.js"></script>
<script>
  // Fallback: if static script failed to load, define chart helper inline.
  if (typeof createLineChart !== "function") {
    function createLineChart(canvas, opts) {
      const options = opts || {};
      const padding = options.padding || 36;
      const color = options.color || "#16baaa";

      function theme() {
        const t = (document.documentElement.getAttribute("data-theme") || "").toLowerCase();
        return t === "dark" ? "dark" : "light";
      }

      function resolveColors() {
        if (theme() === "dark") {
          return {
            grid: options.grid || "rgba(255,255,255,0.12)",
            text: options.text || "rgba(255,255,255,0.65)",
            bg: options.bg || "rgba(0,0,0,0)",
          };
        }
        return {
          grid: options.grid || "rgba(0,0,0,0.08)",
          text: options.text || "rgba(0,0,0,0.55)",
          bg: options.bg || "rgba(0,0,0,0)",
        };
      }

      const ctx = canvas.getContext("2d");
      function draw(points, formatter) {
        const colors = resolveColors();
        const w = canvas.width;
        const h = canvas.height;
        ctx.clearRect(0, 0, w, h);
        ctx.fillStyle = colors.bg;
        ctx.fillRect(0, 0, w, h);
        if (!points || points.length < 2) {
          ctx.fillStyle = colors.text;
          ctx.font = "12px sans-serif";
          ctx.fillText("æš‚æ— æ•°æ®", padding, padding);
          return;
        }
        let minY = Infinity, maxY = -Infinity;
        for (const p of points) { if (p.y < minY) minY = p.y; if (p.y > maxY) maxY = p.y; }
        if (!isFinite(minY) || !isFinite(maxY)) return;
        if (minY === maxY) { maxY = minY + 1; }
        const minX = points[0].x;
        const maxX = points[points.length - 1].x;
        const plotW = w - padding * 2;
        const plotH = h - padding * 2;
        const xToPx = (x) => padding + (x - minX) * plotW / Math.max(1, (maxX - minX));
        const yToPx = (y) => padding + (maxY - y) * plotH / Math.max(1e-9, (maxY - minY));
        ctx.strokeStyle = colors.grid;
        ctx.lineWidth = 1;
        ctx.beginPath();
        for (let i = 0; i <= 4; i++) {
          const y = padding + i * (plotH / 4);
          ctx.moveTo(padding, y);
          ctx.lineTo(w - padding, y);
        }
        ctx.stroke();
        ctx.fillStyle = colors.text;
        ctx.font = "12px sans-serif";
        const fmt = formatter || ((v) => String(v));
        ctx.fillText(fmt(maxY), 6, padding + 4);
        ctx.fillText(fmt(minY), 6, h - padding + 4);
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(xToPx(points[0].x), yToPx(points[0].y));
        for (let i = 1; i < points.length; i++) ctx.lineTo(xToPx(points[i].x), yToPx(points[i].y));
        ctx.stroke();
        const last = points[points.length - 1];
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(xToPx(last.x), yToPx(last.y), 3, 0, Math.PI * 2);
        ctx.fill();
      }
      return { draw };
    }
  }

  function initRealtimeCharts() {
    const intervalMs = 2000;
    const rtRule = document.getElementById("rtRule");
    const rtWindow = document.getElementById("rtWindow");
    const speedCanvas = document.getElementById("rtSpeed");
    const emptyBox = document.getElementById("rtEmpty");
    if (!rtRule || !rtWindow || !speedCanvas) return;

    const speedChart = createLineChart(speedCanvas, { color: "#16baaa" });
    let pointsSpeed = [];
    let errorStreak = 0;

    function canvasFit(canvas) {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      const w = Math.max(200, Math.floor(rect.width * dpr));
      const h = Math.max(160, Math.floor(rect.height * dpr));
      if (canvas.width !== w) canvas.width = w;
      if (canvas.height !== h) canvas.height = h;
    }

    function humanBytes(n) {
      const u = 1024;
      if (n < u) return n + " B";
      const units = ["KiB","MiB","GiB","TiB","PiB"];
      let i = -1;
      let v = n;
      while (v >= u && i < units.length - 1) { v /= u; i++; }
      return v.toFixed(1) + " " + units[i];
    }
    function humanSpeed(n) { return humanBytes(n) + "/s"; }

    function capPoints() {
      const windowSec = parseInt(rtWindow.value || "3600", 10);
      const maxPoints = Math.max(10, Math.floor(windowSec * 1000 / intervalMs));
      if (pointsSpeed.length > maxPoints) pointsSpeed = pointsSpeed.slice(pointsSpeed.length - maxPoints);
    }

    async function tick() {
      try {
        const ruleID = rtRule.value || "";
        const r = await fetch("/api/stats/now?rule_id=" + encodeURIComponent(ruleID));
        if (!r.ok) return;
        const d = await r.json();
        errorStreak = 0;
        if (emptyBox) emptyBox.style.display = (d.runningJobs || 0) === 0 ? "" : "none";
        pointsSpeed.push({ x: d.ts, y: d.speedTotal || 0 });
        
        // Update realtime stats text
        const elSpeed = document.getElementById("statSpeed");
        if (elSpeed) elSpeed.innerText = humanSpeed(d.speedTotal || 0);
        const elToday = document.getElementById("statToday");
        if (elToday) elToday.innerText = humanBytes(d.bytesToday || 0);
        const el24h = document.getElementById("stat24h");
        if (el24h) el24h.innerText = humanBytes(d.bytes24h || 0);

        capPoints();
        canvasFit(speedCanvas);
        speedChart.draw(pointsSpeed, (v) => humanSpeed(v));
      } catch (e) {
        errorStreak++;
        if (emptyBox && errorStreak >= 3) {
          emptyBox.style.display = "";
          emptyBox.classList.add("alert-warning");
          emptyBox.textContent = "å®æ—¶é‡‡æ ·å¤±è´¥ï¼šè¯·æ£€æŸ¥ /api/stats/now æ˜¯å¦å¯è®¿é—®ï¼Œä»¥åŠæµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰æŠ¥é”™ã€‚";
        }
      }
    }

    function reset() {
      pointsSpeed = [];
      canvasFit(speedCanvas);
      speedChart.draw(pointsSpeed, (v) => humanSpeed(v));
    }

    rtRule.addEventListener("change", reset);
    rtWindow.addEventListener("change", reset);
    window.addEventListener("resize", () => {
      canvasFit(speedCanvas);
      speedChart.draw(pointsSpeed, (v) => humanSpeed(v));
    });
    reset();
    tick();
    setInterval(tick, intervalMs);
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initRealtimeCharts);
  } else {
    initRealtimeCharts();
  }
</script>
{{end}}
